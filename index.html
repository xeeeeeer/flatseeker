<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>FlatSeeker ‚Äî –†–æ–∑—à–∏—Ä–µ–Ω–∏–π –ø–æ—à—É–∫ –æ—Ä–µ–Ω–¥–∏</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0c0c0e;
      --card: #16161a;
      --card-hover: #1c1c21;
      --text: #f4f4f5;
      --muted: #71717a;
      --accent: #6366f1;
      --accent-light: #818cf8;
      --accent-glow: rgba(99, 102, 241, 0.35);
      --success: #22c55e;
      --radius: 16px;
      --radius-sm: 12px;
      --shadow: 0 8px 32px rgba(0,0,0,0.4);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 0;
      font-family: 'Manrope', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding-bottom: 100px;
      line-height: 1.5;
    }
    .hero {
      background: linear-gradient(160deg, #1e1b4b 0%, #0f0f12 55%);
      padding: 24px 18px 28px;
      margin-bottom: 12px;
      text-align: center;
    }
    .hero h1 {
      font-size: 22px;
      font-weight: 700;
      margin: 0 0 8px;
      letter-spacing: -0.03em;
    }
    .hero .tagline {
      font-size: 14px;
      color: var(--muted);
      margin: 0;
    }
    .trust {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 16px;
      flex-wrap: wrap;
    }
    .trust-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 500;
      background: rgba(99, 102, 241, 0.2);
      color: var(--accent-light);
    }
    .trust-badge.second {
      background: rgba(34, 197, 94, 0.15);
      color: #4ade80;
    }
    .section {
      background: var(--card);
      border-radius: var(--radius);
      padding: 18px 20px;
      margin: 0 16px 14px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,0.04);
    }
    .section-title {
      font-size: 11px;
      font-weight: 600;
      margin-bottom: 14px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }
    .city-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin-top: 8px;
    }
    .city-btn {
      padding: 10px 8px;
      border-radius: var(--radius-sm);
      border: 1px solid #27272a;
      background: var(--bg);
      color: var(--text);
      font-size: 13px;
      font-family: inherit;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
    }
    .city-btn:hover {
      background: var(--card-hover);
      border-color: #3f3f46;
    }
    .city-btn.selected {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
      box-shadow: 0 0 0 2px var(--accent-glow);
    }
    .city-selected-label {
      font-size: 12px;
      color: var(--muted);
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid rgba(255,255,255,0.06);
    }
    .city-selected-label strong { color: var(--accent-light); }
    .districts-section { margin-top: 14px; }
    .districts-section.hidden { display: none; }
    .district-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 6px 12px;
      max-height: 220px;
      overflow-y: auto;
      margin-top: 10px;
      padding-right: 4px;
    }
    .district-grid::-webkit-scrollbar { width: 4px; }
    .district-grid::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 4px; }
    .district-chip {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: var(--radius-sm);
      border: 1px solid #27272a;
      background: var(--bg);
      color: var(--text);
      font-size: 13px;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.2s;
      text-align: left;
    }
    .district-chip:hover { background: var(--card-hover); border-color: #3f3f46; }
    .district-chip.selected {
      background: rgba(99, 102, 241, 0.25);
      border-color: var(--accent);
      color: var(--accent-light);
    }
    .district-chip input { display: none; }
    .district-chip .check { opacity: 0.4; font-size: 14px; }
    .district-chip.selected .check { opacity: 1; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
    .checkbox-wrap {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 8px 0;
      cursor: pointer;
      padding: 4px 0;
    }
    .checkbox-wrap input {
      width: 22px;
      height: 22px;
      accent-color: var(--accent);
      cursor: pointer;
    }
    .checkbox-wrap label { font-size: 14px; color: var(--text); cursor: pointer; }
    input[type="number"], input[type="text"] {
      width: 100%;
      max-width: 130px;
      padding: 12px 14px;
      border-radius: var(--radius-sm);
      border: 1px solid #27272a;
      background: var(--bg);
      color: var(--text);
      font-size: 16px;
      font-family: inherit;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px var(--accent-glow);
    }
    label.inline { font-size: 13px; color: var(--muted); margin-right: 8px; }
    .interval-row { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
    .interval-btn {
      padding: 10px 16px;
      border-radius: var(--radius-sm);
      border: 1px solid #27272a;
      background: var(--bg);
      color: var(--text);
      font-size: 13px;
      font-family: inherit;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    .interval-btn:hover { background: var(--card-hover); border-color: #3f3f46; }
    .interval-btn.active {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
    }
    .save-btn {
      position: fixed;
      bottom: 20px;
      left: 16px;
      right: 16px;
      padding: 16px 24px;
      background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
      color: #fff;
      border: none;
      border-radius: var(--radius);
      font-size: 17px;
      font-weight: 600;
      font-family: inherit;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      box-shadow: 0 4px 24px var(--accent-glow);
      transition: transform 0.15s, box-shadow 0.15s;
    }
    .save-btn:active { transform: scale(0.98); }
    .save-btn:disabled { opacity: 0.7; cursor: not-allowed; }
    .price-hint { font-size: 11px; color: var(--muted); margin-top: 4px; }
    .emoji { font-style: normal; }
  </style>
</head>
<body>
  <div class="hero">
    <h1>üè† FlatSeeker</h1>
    <p class="tagline">–ü–æ—à—É–∫ —Ç–∞ –æ—Ä–µ–Ω–¥–∞ –∫–≤–∞—Ä—Ç–∏—Ä –ø–æ –≤—Å—ñ–π –£–∫—Ä–∞—ó–Ω—ñ</p>
    <div class="trust">
      <span class="trust-badge">‚ö° –ú–∏—Ç—Ç—î–≤—ñ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è</span>
      <span class="trust-badge second">üîí –¢—ñ–ª—å–∫–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ñ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è</span>
    </div>
  </div>

  <div class="section">
    <div class="section-title">–õ–æ–∫–∞—Ü—ñ—è *</div>
    <p class="city-selected-label">1) –û–±–µ—Ä—ñ—Ç—å –º—ñ—Å—Ç–æ: <strong id="cityDisplay">–ö–∏—ó–≤</strong></p>
    <div class="city-grid" id="cityGrid"></div>
    <div class="districts-section" id="districtsSection">
      <p class="section-title" style="margin-bottom: 6px;">2) –û–±–µ—Ä—ñ—Ç—å —Ä–∞–π–æ–Ω–∏ (–∞–±–æ –ø–æ –≤—Å—å–æ–º—É –º—ñ—Å—Ç—É)</p>
      <div class="district-grid" id="districtGrid"></div>
    </div>
    <div class="checkbox-wrap" style="margin-top: 14px;">
      <input type="checkbox" id="allCity" checked>
      <label for="allCity">–®—É–∫–∞—Ç–∏ –ø–æ –≤—Å—å–æ–º—É –º—ñ—Å—Ç—É</label>
    </div>
  </div>

  <div class="section">
    <div class="section-title">–ö—ñ–º–Ω–∞—Ç–∏</div>
    <div class="row">
      <div class="checkbox-wrap"><input type="checkbox" id="r1"><label for="r1">1</label></div>
      <div class="checkbox-wrap"><input type="checkbox" id="r2"><label for="r2">2</label></div>
      <div class="checkbox-wrap"><input type="checkbox" id="r3"><label for="r3">3</label></div>
      <div class="checkbox-wrap"><input type="checkbox" id="r4"><label for="r4">4</label></div>
      <div class="checkbox-wrap"><input type="checkbox" id="r5"><label for="r5">5</label></div>
    </div>
  </div>

  <div class="section">
    <div class="section-title">–¶—ñ–Ω–∞ (–≥—Ä–Ω/–º—ñ—Å)</div>
    <div class="row">
      <label class="inline">–í—ñ–¥:</label>
      <input type="number" id="priceMin" placeholder="5000" min="0" value="">
      <label class="inline">–î–æ:</label>
      <input type="number" id="priceMax" placeholder="15000" min="0" value="">
    </div>
    <p class="price-hint">–ó–∞–ª–∏—à—Ç–µ –ø–æ—Ä–æ–∂–Ω—ñ–º, —â–æ–± –Ω–µ –æ–±–º–µ–∂—É–≤–∞—Ç–∏ –∑–∞ —Ü—ñ–Ω–æ—é</p>
  </div>

  <div class="section">
    <div class="section-title">–ü–æ–≤–µ—Ä—Ö</div>
    <div class="row">
      <label class="inline">–í—ñ–¥:</label>
      <input type="number" id="floorMin" placeholder="‚Äî" min="0">
      <label class="inline">–î–æ:</label>
      <input type="number" id="floorMax" placeholder="‚Äî" min="0">
    </div>
  </div>

  <div class="section">
    <div class="section-title">–î–æ–¥–∞—Ç–∫–æ–≤—ñ —É–º–æ–≤–∏</div>
    <div class="checkbox-wrap">
      <input type="checkbox" id="noCommission">
      <label for="noCommission"><span class="emoji">üí∞</span> –ë–µ–∑ –∫–æ–º—ñ—Å—ñ—ó –∞–≥–µ–Ω—Ç—É</label>
    </div>
    <div class="checkbox-wrap">
      <input type="checkbox" id="petsAllowed">
      <label for="petsAllowed"><span class="emoji">üêï</span> –ú–æ–∂–Ω–∞ –∑ —Ç–≤–∞—Ä–∏–Ω–∞–º–∏</label>
    </div>
    <div class="checkbox-wrap">
      <input type="checkbox" id="childrenAllowed">
      <label for="childrenAllowed"><span class="emoji">üë∂</span> –ú–æ–∂–Ω–∞ –∑ –¥—ñ—Ç—å–º–∏</label>
    </div>
  </div>

  <div class="section">
    <div class="section-title">–Ø–∫ —á–∞—Å—Ç–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –Ω–æ–≤—ñ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è? *</div>
    <div class="interval-row" id="intervals">
      <button type="button" class="interval-btn" data-min="1">1 —Ö–≤</button>
      <button type="button" class="interval-btn" data-min="5">5 —Ö–≤</button>
      <button type="button" class="interval-btn" data-min="15">15 —Ö–≤</button>
      <button type="button" class="interval-btn" data-min="30">30 —Ö–≤</button>
      <button type="button" class="interval-btn" data-min="60">1 –≥–æ–¥</button>
      <button type="button" class="interval-btn" data-min="120">2 –≥–æ–¥</button>
      <button type="button" class="interval-btn" data-min="360">6 –≥–æ–¥</button>
    </div>
  </div>

  <button type="button" class="save-btn" id="saveBtn">üëç –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ –ø–æ—à—É–∫</button>

  <script>
    const CITIES = [
      "–ö–∏—ó–≤", "–õ—å–≤—ñ–≤", "–•–∞—Ä–∫—ñ–≤", "–û–¥–µ—Å–∞", "–î–Ω—ñ–ø—Ä–æ", "–ó–∞–ø–æ—Ä—ñ–∂–∂—è", "–ú–∏–∫–æ–ª–∞—ó–≤", "–í—ñ–Ω–Ω–∏—Ü—è",
      "–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫", "–¢–µ—Ä–Ω–æ–ø—ñ–ª—å", "–õ—É—Ü—å–∫", "–•–º–µ–ª—å–Ω–∏—Ü—å–∫–∏–π", "–ß–µ—Ä–∫–∞—Å–∏", "–†—ñ–≤–Ω–µ", "–ü–æ–ª—Ç–∞–≤–∞",
      "–ñ–∏—Ç–æ–º–∏—Ä", "–ß–µ—Ä–Ω—ñ–≤—Ü—ñ", "–ö—Ä–æ–ø–∏–≤–Ω–∏—Ü—å–∫–∏–π", "–ß–µ—Ä–Ω—ñ–≥—ñ–≤", "–°—É–º–∏", "–£–∂–≥–æ—Ä–æ–¥", "–•–µ—Ä—Å–æ–Ω",
      "–ü–∞–≤–ª–æ–≥—Ä–∞–¥", "–ö—Ä–∏–≤–∏–π –†—ñ–≥", "–ö—Ä–µ–º–µ–Ω—á—É–∫", "–ö–∞–º'—è–Ω–µ—Ü—å-–ü–æ–¥—ñ–ª—å—Å—å–∫–∏–π", "–ë—ñ–ª–∞ –¶–µ—Ä–∫–≤–∞", "–£–º–∞–Ω—å",
      "–ö–∞–º'—è–Ω—Å—å–∫–µ", "–Ü—Ä–ø—ñ–Ω—å", "–ú–∞—Ä—ñ—É–ø–æ–ª—å"
    ];

    var CITY_DISTRICTS = {
      "–ö–∏—ó–≤": [
        { id: "holosiivskyi", name: "–ì–æ–ª–æ—Å—ñ—ó–≤—Å—å–∫–∏–π" }, { id: "darnytskyi", name: "–î–∞—Ä–Ω–∏—Ü—å–∫–∏–π" },
        { id: "desnianskyi", name: "–î–µ—Å–Ω—è–Ω—Å—å–∫–∏–π" }, { id: "dniprovskyi", name: "–î–Ω—ñ–ø—Ä–æ–≤—Å—å–∫–∏–π" },
        { id: "obolonskyi", name: "–û–±–æ–ª–æ–Ω—Å—å–∫–∏–π" }, { id: "pecherskyi", name: "–ü–µ—á–µ—Ä—Å—å–∫–∏–π" },
        { id: "podilskyi", name: "–ü–æ–¥—ñ–ª—å—Å—å–∫–∏–π" }, { id: "sviatoshynskyi", name: "–°–≤—è—Ç–æ—à–∏–Ω—Å—å–∫–∏–π" },
        { id: "solomianskyi", name: "–°–æ–ª–æ–º'—è–Ω—Å—å–∫–∏–π" }, { id: "shevchenkivskyi", name: "–®–µ–≤—á–µ–Ω–∫—ñ–≤—Å—å–∫–∏–π" }
      ],
      "–•–∞—Ä–∫—ñ–≤": [
        { id: "kholodnohirskyi", name: "–•–æ–ª–æ–¥–Ω–æ–≥—ñ—Ä—Å—å–∫–∏–π" }, { id: "shevchenkivskyi", name: "–®–µ–≤—á–µ–Ω–∫—ñ–≤—Å—å–∫–∏–π" },
        { id: "kyivskyi", name: "–ö–∏—ó–≤—Å—å–∫–∏–π" }, { id: "saltivskyi", name: "–°–∞–ª—Ç—ñ–≤—Å—å–∫–∏–π" },
        { id: "nemyshlianskyi", name: "–ù–µ–º–∏—à–ª—è–Ω—Å—å–∫–∏–π" }, { id: "industrialnyi", name: "–Ü–Ω–¥—É—Å—Ç—Ä—ñ–∞–ª—å–Ω–∏–π" },
        { id: "slobidskyi", name: "–°–ª–æ–±—ñ–¥—Å—å–∫–∏–π" }, { id: "osnovianskyi", name: "–û—Å–Ω–æ–≤'—è–Ω—Å—å–∫–∏–π" },
        { id: "novobavarskyi", name: "–ù–æ–≤–æ–±–∞–≤–∞—Ä—Å—å–∫–∏–π" }
      ],
      "–û–¥–µ—Å–∞": [
        { id: "prymorskyi", name: "–ü—Ä–∏–º–æ—Ä—Å—å–∫–∏–π" }, { id: "suvorovskyi", name: "–°—É–≤–æ—Ä–æ–≤—Å—å–∫–∏–π" },
        { id: "malynovskyi", name: "–ú–∞–ª–∏–Ω–æ–≤—Å—å–∫–∏–π" }
      ],
      "–õ—å–≤—ñ–≤": [
        { id: "halytskyi", name: "–ì–∞–ª–∏—Ü—å–∫–∏–π" }, { id: "zaliznychnyi", name: "–ó–∞–ª—ñ–∑–Ω–∏—á–Ω–∏–π" },
        { id: "lychakivskyi", name: "–õ–∏—á–∞–∫—ñ–≤—Å—å–∫–∏–π" }, { id: "frankivskyi", name: "–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫–∏–π" },
        { id: "shevchenkivskyi", name: "–®–µ–≤—á–µ–Ω–∫—ñ–≤—Å—å–∫–∏–π" }
      ],
      "–î–Ω—ñ–ø—Ä–æ": [
        { id: "amur-nizhnodniprovskyi", name: "–ê–º—É—Ä-–ù–∏–∂–Ω—å–æ–¥–Ω—ñ–ø—Ä–æ–≤—Å—å–∫–∏–π" }, { id: "industrialnyi", name: "–Ü–Ω–¥—É—Å—Ç—Ä—ñ–∞–ª—å–Ω–∏–π" },
        { id: "novokodatskyi", name: "–ù–æ–≤–æ–∫–æ–¥–∞—Ü—å–∫–∏–π" }, { id: "samarskyi", name: "–°–∞–º–∞—Ä—Å—å–∫–∏–π" },
        { id: "tsentralnyi", name: "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∏–π" }, { id: "chechelskyi", name: "–ß–µ—á–µ–ª—ñ–≤—Å—å–∫–∏–π" },
        { id: "shevchenkivskyi", name: "–®–µ–≤—á–µ–Ω–∫—ñ–≤—Å—å–∫–∏–π" }
      ],
      "–ó–∞–ø–æ—Ä—ñ–∂–∂—è": [
        { id: "oleksandrivskyi", name: "–û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤—Å—å–∫–∏–π" }, { id: "komunarskyi", name: "–ö–æ–º—É–Ω–∞—Ä—Å—å–∫–∏–π" },
        { id: "zavodskyi", name: "–ó–∞–≤–æ–¥—Å—å–∫–∏–π" }, { id: "khortytskyi", name: "–•–æ—Ä—Ç–∏—Ü—å–∫–∏–π" },
        { id: "shevchenkivskyi", name: "–®–µ–≤—á–µ–Ω–∫—ñ–≤—Å—å–∫–∏–π" }
      ],
      "–í—ñ–Ω–Ω–∏—Ü—è": [
        { id: "zamostianskyi", name: "–ó–∞–º–æ—Å—Ç—è–Ω—Å—å–∫–∏–π" }, { id: "leninskyi", name: "–õ–µ–Ω—ñ–Ω—Å—å–∫–∏–π" },
        { id: "staromiskii", name: "–°—Ç–∞—Ä–æ–º—ñ—Å—å–∫–∏–π" }
      ],
      "–ß–µ—Ä–Ω—ñ–≤—Ü—ñ": [
        { id: "pershotravnevyi", name: "–ü–µ—Ä—à–æ—Ç—Ä–∞–≤–Ω–µ–≤–∏–π" }, { id: "sadhirskyi", name: "–°–∞–¥–≥—ñ—Ä—Å—å–∫–∏–π" },
        { id: "shevchenkivskyi", name: "–®–µ–≤—á–µ–Ω–∫—ñ–≤—Å—å–∫–∏–π" }
      ],
      "–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫": [
        { id: "halytskyi", name: "–ì–∞–ª–∏—Ü—å–∫–∏–π" }, { id: "nahirnianskyi", name: "–ù–∞–≥—ñ—Ä–Ω—è–Ω—Å—å–∫–∏–π" }
      ],
      "–¢–µ—Ä–Ω–æ–ø—ñ–ª—å": [
        { id: "tsentralnyi", name: "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∏–π" }, { id: "shevchenkivskyi", name: "–®–µ–≤—á–µ–Ω–∫—ñ–≤—Å—å–∫–∏–π" }
      ],
      "–ß–µ—Ä–∫–∞—Å–∏": [
        { id: "sosnivskyi", name: "–°–æ—Å–Ω—ñ–≤—Å—å–∫–∏–π" }, { id: "pridniprovskyi", name: "–ü—Ä–∏–¥–Ω—ñ–ø—Ä–æ–≤—Å—å–∫–∏–π" }
      ],
      "–ü–æ–ª—Ç–∞–≤–∞": [
        { id: "shevchenkivskyi", name: "–®–µ–≤—á–µ–Ω–∫—ñ–≤—Å—å–∫–∏–π" }, { id: "podilskyi", name: "–ü–æ–¥—ñ–ª—å—Å—å–∫–∏–π" },
        { id: "kyivskyi", name: "–ö–∏—ó–≤—Å—å–∫–∏–π" }
      ],
      "–ß–µ—Ä–Ω—ñ–≥—ñ–≤": [
        { id: "desnianskyi", name: "–î–µ—Å–Ω—è–Ω—Å—å–∫–∏–π" }, { id: "novozavodskyi", name: "–ù–æ–≤–æ–∑–∞–≤–æ–¥—Å—å–∫–∏–π" }
      ],
      "–°—É–º–∏": [
        { id: "kovpakovskyi", name: "–ö–æ–≤–ø–∞–∫—ñ–≤—Å—å–∫–∏–π" }, { id: "zakhidnyi", name: "–ó–∞—Ö—ñ–¥–Ω–∏–π" }
      ]
    };

    const tg = window.Telegram?.WebApp;
    if (tg) {
      tg.ready();
      tg.expand();
      tg.MainButton?.hide();
    }

    let selectedCity = "–ö–∏—ó–≤";
    let selectedDistrictIds = [];
    const cityGrid = document.getElementById("cityGrid");
    const cityDisplay = document.getElementById("cityDisplay");
    const districtsSection = document.getElementById("districtsSection");
    const districtGrid = document.getElementById("districtGrid");
    const allCityCheck = document.getElementById("allCity");

    function getDistrictsForCity(city) {
      return CITY_DISTRICTS[city] || [];
    }

    function renderDistrictGrid() {
      var districts = getDistrictsForCity(selectedCity);
      districtGrid.innerHTML = "";
      if (districts.length === 0) {
        districtGrid.innerHTML = "<p style=\"color: var(--muted); font-size: 13px; grid-column: 1/-1;\">–î–ª—è —Ü—å–æ–≥–æ –º—ñ—Å—Ç–∞ –º–æ–∂–Ω–∞ —à—É–∫–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ –ø–æ –≤—Å—å–æ–º—É –º—ñ—Å—Ç—É.</p>";
        return;
      }
      districts.forEach(function(d) {
        var isSelected = selectedDistrictIds.indexOf(d.id) !== -1;
        var label = document.createElement("label");
        label.className = "district-chip" + (isSelected ? " selected" : "");
        label.innerHTML = "<span class=\"check\">" + (isSelected ? "‚úì" : "‚óã") + "</span> " + d.name;
        var input = document.createElement("input");
        input.type = "checkbox";
        input.value = d.id;
        input.checked = isSelected;
        label.appendChild(input);
        label.addEventListener("click", function(e) {
          e.preventDefault();
          var idx = selectedDistrictIds.indexOf(d.id);
          if (idx === -1) {
            selectedDistrictIds.push(d.id);
            allCityCheck.checked = false;
          } else {
            selectedDistrictIds.splice(idx, 1);
            if (selectedDistrictIds.length === 0) allCityCheck.checked = true;
          }
          renderDistrictGrid();
        });
        districtGrid.appendChild(label);
      });
    }

    function renderCityGrid() {
      cityGrid.innerHTML = "";
      CITIES.forEach(function(city) {
        var btn = document.createElement("button");
        btn.type = "button";
        btn.className = "city-btn" + (city === selectedCity ? " selected" : "");
        btn.textContent = city;
        btn.addEventListener("click", function() {
          selectedCity = city;
          cityDisplay.textContent = city;
          selectedDistrictIds = [];
          allCityCheck.checked = true;
          document.querySelectorAll(".city-btn").forEach(function(b) {
            b.classList.toggle("selected", b.textContent === city);
          });
          renderDistrictGrid();
        });
        cityGrid.appendChild(btn);
      });
    }
    renderCityGrid();
    renderDistrictGrid();

    allCityCheck.addEventListener("change", function() {
      if (this.checked) selectedDistrictIds = [];
      renderDistrictGrid();
    });

    let selectedInterval = 30;
    document.querySelectorAll(".interval-btn").forEach(function(btn) {
      btn.addEventListener("click", function() {
        document.querySelectorAll(".interval-btn").forEach(function(b) { b.classList.remove("active"); });
        btn.classList.add("active");
        selectedInterval = parseInt(btn.dataset.min, 10);
      });
    });
    var defaultInterval = document.querySelector('[data-min="30"]');
    if (defaultInterval) defaultInterval.classList.add("active");

    document.getElementById("saveBtn").addEventListener("click", function() {
      var btn = this;
      btn.disabled = true;
      btn.textContent = "–ó–±–µ—Ä—ñ–≥–∞—é...";

      var rooms = [];
      for (var i = 1; i <= 5; i++) {
        if (document.getElementById("r" + i).checked) rooms.push(i);
      }
      var priceMin = document.getElementById("priceMin").value;
      var priceMax = document.getElementById("priceMax").value;
      var allCity = document.getElementById("allCity").checked;
      var data = {
        city: selectedCity,
        all_districts: allCity,
        district_ids: allCity ? [] : selectedDistrictIds.slice(),
        rooms_min: rooms.length ? Math.min.apply(null, rooms) : null,
        rooms_max: rooms.length ? Math.max.apply(null, rooms) : null,
        price_min: priceMin ? parseInt(priceMin, 10) : null,
        price_max: priceMax ? parseInt(priceMax, 10) : null,
        floor_min: document.getElementById("floorMin").value ? parseInt(document.getElementById("floorMin").value, 10) : null,
        floor_max: document.getElementById("floorMax").value ? parseInt(document.getElementById("floorMax").value, 10) : null,
        no_commission: document.getElementById("noCommission").checked,
        pets_allowed: document.getElementById("petsAllowed").checked,
        children_allowed: document.getElementById("childrenAllowed").checked,
        interval_minutes: selectedInterval,
        name: "–ó –≤–µ–±-–¥–æ–¥–∞—Ç–∫—É"
      };
      if (tg && tg.sendData) {
        tg.sendData(JSON.stringify(data));
      } else {
        console.log("Data:", data);
        btn.disabled = false;
        btn.textContent = "üëç –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ –ø–æ—à—É–∫";
        alert("–ì–æ—Ç–æ–≤–æ! –£ –±–æ—Ç—ñ –¥–∞–Ω—ñ –∑\'—è–≤–ª—è—Ç—å—Å—è –ø—ñ—Å–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –º—ñ–Ω—ñ-–¥–æ–¥–∞—Ç–∫—É.");
      }
    });
  </script>
</body>
</html>
